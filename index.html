<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>抖音主页链接解析工具</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>
    <!-- 帮助按钮 -->
    <button class="help-trigger" id="helpTrigger" title="使用说明">
        <i class="fas fa-question"></i>
    </button>

    <div class="container">
        <header>
            <h1><i class="fab fa-tiktok"></i> 抖音主页链接解析工具</h1>
            <p>提取抖音主页视频链接，支持文件管理、自动更新和邮件通知</p>
        </header>
        
        <div class="content">
            <div class="alert alert-error" id="errorAlert"></div>
            <div class="alert alert-success" id="successAlert"></div>
            
            <!-- 自动更新设置 - 置顶 -->
            <div class="auto-update-section">
                <div class="section-header" id="autoUpdateHeader">
                    <h3><i class="fas fa-sync-alt"></i> 自动更新设置</h3>
                    <i class="fas fa-chevron-down toggle-icon" id="autoUpdateToggle"></i>
                </div>
                
                <div class="auto-update-controls" id="autoUpdateControls">
                    <div class="input-group">
                        <label for="autoUpdateUrl"><i class="fas fa-link"></i> 监控的抖音主页链接</label>
                        <div class="input-with-icon">
                            <i class="fas fa-paste"></i>
                            <input type="text" id="autoUpdateUrl" placeholder="输入要自动监控的抖音主页链接">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="updateInterval"><i class="fas fa-clock"></i> 更新间隔</label>
                        <div class="input-with-icon">
                            <i class="fas fa-history"></i>
                            <select id="updateInterval">
                                <option value="5">5分钟</option>
                                <option value="10">10分钟</option>
                                <option value="30">30分钟</option>
                                <option value="60" selected>1小时</option>
                                <option value="180">3小时</option>
                                <option value="360">6小时</option>
                                <option value="720">12小时</option>
                                <option value="1440">24小时</option>
                                <option value="custom">自定义</option>
                            </select>
                        </div>
                        <div class="custom-interval" id="customInterval" style="display: none;">
                            <input type="number" id="customIntervalValue" min="1" max="10080" value="60">
                            <select id="customIntervalUnit">
                                <option value="minutes">分钟</option>
                                <option value="hours">小时</option>
                                <option value="days">天</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="updateFileName"><i class="fas fa-file"></i> 自动更新文件名</label>
                        <div class="input-with-icon">
                            <i class="fas fa-font"></i>
                            <input type="text" id="updateFileName" placeholder="自动更新文件名称，默认为auto_update">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="updateType"><i class="fas fa-images"></i> 自动更新类型</label>
                        <div class="input-with-icon">
                            <i class="fas fa-cog"></i>
                            <select id="updateType">
                                <option value="2">解析视频</option>
                                <option value="1">解析图片</option>
                            </select>
                        </div>
                    </div>

                    <!-- 邮件通知设置 -->
                    <div class="email-notification">
                        <h4><i class="fas fa-envelope"></i> 邮件通知设置</h4>
                        <div class="email-toggle">
                            <label class="toggle-switch">
                                <input type="checkbox" id="emailNotification">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>启用邮件通知</span>
                        </div>
                        <div class="email-settings" id="emailSettings" style="display: none;">
                            <div class="input-group">
                                <label for="emailAddress"><i class="fas fa-envelope"></i> 接收邮箱</label>
                                <input type="email" id="emailAddress" placeholder="输入接收通知的邮箱地址">
                            </div>
                            <div class="input-group">
                                <label for="emailCondition"><i class="fas fa-bell"></i> 通知条件</label>
                                <select id="emailCondition">
                                    <option value="always">每次更新都通知</option>
                                    <option value="new_content" selected>只有新内容时通知</option>
                                    <option value="error">只有出错时通知</option>
                                </select>
                            </div>
                            
                            <div class="smtp-config">
                                <h5><i class="fas fa-cog"></i> SMTP服务器配置</h5>
                                <div class="email-settings-grid">
                                    <div class="input-group">
                                        <label for="smtpHost"><i class="fas fa-server"></i> SMTP服务器</label>
                                        <input type="text" id="smtpHost" placeholder="smtp.qq.com">
                                    </div>
                                    <div class="input-group">
                                        <label for="smtpPort"><i class="fas fa-plug"></i> 端口</label>
                                        <input type="number" id="smtpPort" placeholder="465" value="465">
                                    </div>
                                    <div class="input-group">
                                        <label for="smtpUsername"><i class="fas fa-user"></i> 邮箱账号</label>
                                        <input type="text" id="smtpUsername" placeholder="your-email@qq.com">
                                    </div>
                                    <div class="input-group">
                                        <label for="smtpPassword"><i class="fas fa-lock"></i> 授权码/密码</label>
                                        <input type="password" id="smtpPassword" placeholder="输入SMTP授权码">
                                    </div>
                                    <div class="input-group">
                                        <label for="smtpEncryption"><i class="fas fa-shield-alt"></i> 加密方式</label>
                                        <select id="smtpEncryption">
                                            <option value="ssl">SSL</option>
                                            <option value="tls">TLS</option>
                                            <option value="">无加密</option>
                                        </select>
                                    </div>
                                    <div class="input-group">
                                        <label for="fromName"><i class="fas fa-signature"></i> 发件人名称</label>
                                        <input type="text" id="fromName" placeholder="抖音监控系统" value="抖音监控系统">
                                    </div>
                                </div>
                                <div class="smtp-actions">
                                    <button class="btn btn-info" id="testEmailBtn">
                                        <i class="fas fa-paper-plane"></i> 测试邮件发送
                                    </button>
                                    <button class="btn btn-success" id="saveSmtpBtn">
                                        <i class="fas fa-save"></i> 保存SMTP配置
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="auto-update-actions">
                        <button class="btn btn-primary" id="startAutoUpdate">
                            <i class="fas fa-play"></i> 开始自动更新
                        </button>
                        <button class="btn btn-danger" id="stopAutoUpdate" disabled>
                            <i class="fas fa-stop"></i> 停止自动更新
                        </button>
                        <button class="btn btn-info" id="checkNow">
                            <i class="fas fa-sync"></i> 立即检查更新
                        </button>
                    </div>
                    
                    <div class="auto-update-status" id="autoUpdateStatus">
                        <div class="status-indicator stopped">
                            <i class="fas fa-circle"></i>
                            <span>自动更新已停止</span>
                        </div>
                        <div class="status-info" id="statusInfo">
                            上次检查: 从未 | 下次检查: - | 更新次数: 0
                        </div>
                    </div>
                    
                    <div class="update-history" id="updateHistory">
                        <h4><i class="fas fa-history"></i> 更新历史</h4>
                        <div class="history-list" id="historyList">
                            <div class="empty-state">
                                <i class="fas fa-clock"></i>
                                <p>暂无更新记录</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 解析提示 -->
            <div class="parse-tips">
                <i class="fas fa-info-circle"></i>
                <div style="flex: 1;">
                    <strong>使用提示：</strong> 如果多次解析失败，请尝试更换抖音主页链接。主页视频数量过多时，解析时间可能会较长。
                    <a href="javascript:void(0)" id="showHelp">
                        <i class="fas fa-question-circle"></i> 查看详细说明
                    </a>
                </div>
            </div>
            
            <div class="input-group">
                <label for="douyinUrl"><i class="fas fa-link"></i> 抖音主页链接</label>
                <div class="input-with-icon">
                    <i class="fas fa-paste"></i>
                    <input type="text" id="douyinUrl" placeholder="粘贴抖音主页链接，如：https://v.douyin.com/xxxxx/">
                </div>
            </div>
            
            <div class="input-group">
                <label for="fileName"><i class="fas fa-file"></i> 自定义文件名（可选）</label>
                <div class="input-with-icon">
                    <i class="fas fa-font"></i>
                    <input type="text" id="fileName" placeholder="输入保存的文件名，默认为video_links">
                </div>
            </div>
            
            <!-- 解析类型选择 -->
            <div class="input-group">
                <label for="parseType"><i class="fas fa-images"></i> 解析类型</label>
                <div class="input-with-icon">
                    <i class="fas fa-cog"></i>
                    <select id="parseType">
                        <option value="2">解析视频</option>
                        <option value="1">解析图片</option>
                    </select>
                </div>
            </div>
            
            <!-- 时间警告 -->
            <div class="time-warning">
                <i class="fas fa-clock"></i>
                <span><strong>注意：</strong> 如果主页视频数量较多，解析过程可能需要较长时间，请耐心等待...</span>
            </div>
            
            <button class="btn btn-primary" id="parseBtn">
                <i class="fas fa-magic"></i> 解析链接
            </button>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>正在解析链接，请稍候...</p>
                <p style="font-size: 14px; color: #666; margin-top: 10px;">
                    <i class="fas fa-info-circle"></i> 如果长时间没有响应，请尝试更换链接
                </p>
            </div>
            
            <div class="result-container" id="resultContainer">
                <div class="result-box">
                    <div class="result-title">
                        <i class="fas fa-check-circle"></i> 解析成功
                        <span class="video-count" id="videoCount">0</span>
                    </div>
                    <p>已成功提取视频链接，点击下方按钮下载或复制链接。</p>
                    
                    <div class="download-info">
                        <div>
                            <div class="file-name" id="fileNameDisplay">video_links.txt</div>
                            <div id="fileInfo">包含 <span id="linkCount">0</span> 个视频链接</div>
                        </div>
                        <div class="actions">
                            <button class="btn btn-download" id="downloadBtn">
                                <i class="fas fa-download"></i> 下载文件
                            </button>
                            <button class="btn btn-copy" id="copyBtn">
                                <i class="fas fa-copy"></i> 复制链接
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 文件管理区域 -->
            <div class="file-manager">
                <div class="file-manager-header">
                    <h3>
                        <i class="fas fa-folder-open"></i> 文件管理 
                        <span class="file-count" id="fileCount">0</span>
                    </h3>
                    <div class="file-manager-actions">
                        <button class="btn btn-refresh" id="refreshBtn">
                            <i class="fas fa-sync-alt"></i> 刷新列表
                        </button>
                        <button class="btn btn-cleanup" id="cleanupBtn">
                            <i class="fas fa-broom"></i> 自动清理
                        </button>
                    </div>
                </div>
                
                <!-- 自动清理控制 -->
                <div class="cleanup-controls">
                    <span>自动清理：</span>
                    <select id="cleanupHours">
                        <option value="1">1小时前</option>
                        <option value="6">6小时前</option>
                        <option value="24" selected>24小时前</option>
                        <option value="72">3天前</option>
                        <option value="168">7天前</option>
                        <option value="720">30天前</option>
                    </select>
                    <span>的文件</span>
                </div>
                
                <div class="file-list" id="fileList">
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <p>暂无文件，解析链接后文件将显示在这里</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 说明弹窗 -->
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-info-circle"></i> 使用说明</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="warning-box">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>重要提示：如果多次解析失败，请更换抖音主页链接！</strong>
                        <div style="margin-top: 8px; font-size: 14px; opacity: 0.9;">
                            某些链接可能由于平台限制无法正常解析，建议尝试其他主页链接。
                        </div>
                    </div>
                </div>
                
                <h4>常见问题解答：</h4>
                <ul class="tips-list">
                    <li>
                        <strong>解析失败怎么办？</strong>
                        请尝试更换其他抖音主页链接，某些链接可能无法正常解析。建议使用抖音短链接格式。
                    </li>
                    <li>
                        <strong>为什么解析时间很长？</strong>
                        如果主页视频数量过多（超过50个），解析过程可能需要30秒到2分钟，请耐心等待不要刷新页面。
                    </li>
                    <li>
                        <strong>支持的链接格式：</strong>
                        • https://v.douyin.com/xxxxx/<br>
                        • https://www.douyin.com/user/xxxx<br>
                        • 其他抖音官方链接格式
                    </li>
                    <li>
                        <strong>文件保存位置：</strong>
                        所有解析的文件都保存在服务器的 <code>downloads</code> 文件夹中。
                    </li>
                    <li>
                        <strong>自动清理功能：</strong>
                        可以自动清理指定时间前生成的文件，避免占用过多服务器空间。
                    </li>
                    <li>
                        <strong>自动更新功能：</strong>
                        可以设置定时监控抖音主页，自动检测新内容并更新文件。
                    </li>
                    <li>
                        <strong>邮件通知：</strong>
                        开启后，系统会在检测到新内容或出现错误时发送邮件通知。
                    </li>
                    <li>
                        <strong>SMTP配置说明：</strong>
                        需要配置正确的SMTP服务器信息才能发送邮件通知。
                    </li>
                </ul>
            </div>
            <div class="modal-footer">
                <button class="btn-understand" id="understandBtn">
                    <i class="fas fa-check"></i> 我明白了，开始使用
                </button>
            </div>
        </div>
    </div>

    <!-- 文件预览弹窗 -->
    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-eye"></i> 文件预览</h3>
                <button class="close-modal" id="closePreviewModal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="previewFileName" style="margin-bottom: 15px; font-weight: 600; color: #444;"></div>
                <div class="file-preview-content" id="filePreviewContent">
                    <!-- 文件内容将在这里显示 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-download" onclick="downloadPreviewFile()">
                    <i class="fas fa-download"></i> 下载此文件
                </button>
                <button class="btn-understand" id="closePreviewBtn">
                    <i class="fas fa-times"></i> 关闭预览
                </button>
            </div>
        </div>
    </div>

    <script src="js/script.js"></script>
</body>
</html>